<?php

class VulnerabilityController extends Zend_Controller_Action {


    public function vulnerabilityAction(){

        $id = $this->_request->getParam('id');
        $model = new Model_Vuln();
        $this->view->vuln = $model->getVulnById((int)$id);
        $mini_title = substr($this->view->vuln['summary'],0,65);
        $this->view->title = $this->view->vuln['ext-id']. ' - '  .$mini_title;
        $this->view->topic = $this->_findTopic($this->view->vuln['summary']);
    }




    private function _findTopic( $corpus ){
        //first check if "for" exists
        $of_count = substr_count($corpus,' of ');
        $the_count = substr_count($corpus,'The ');
        $for_count = substr_count($corpus,' for ');
        $on_count = substr_count($corpus,' on ');
        $in_count = substr_count($corpus,' in ');

        if($for_count > 0){
            $pos = stripos($corpus,' for ');
            $topic = trim( substr($corpus, $pos+4) );
            $topic = explode(' ', $topic);
            return $topic[0];
        }
        else if($the_count > 0){
            $pos = stripos($corpus,'The ');
            $topic = trim( substr($corpus, $pos+4) );
            $topic = explode(' ', $topic);
            return $topic[0];
        }
        else if($on_count > 0){
            $pos = strripos($corpus,' on ');
            $topic = trim( substr($corpus, $pos+4) );
            $topic = explode(' ', $topic);
            return $topic[0];
        }
        else if ($in_count > 0 ){
            $pos = strripos($corpus,' in ');
            $topic = trim( substr($corpus, $pos+3) );
            list($word1, $word2, $word3) = explode( ' ', $topic) ;
            return $topic = $word1 . ' ' . $word2 . ' ' . $word3;
        }
        else if($of_count > 1){
            $pos = stripos($corpus,' of ');
            $topic = trim( substr($corpus, $pos+4) );
            $topic = explode(' ', $topic);
            return $topic[0];
        }
        else{
            $topic = substr($corpus, 0);
            $topic = explode(' ', $topic);
            return $topic[0] . ' ' . $topic[1];
        }
    }
}
